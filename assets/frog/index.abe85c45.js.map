{"mappings":"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","sources":["public/src/client/player.js"],"sourcesContent":["function isCyclic (obj) {\r\n  var seenObjects = [];\r\n\r\n  function detect (obj) {\r\n    if (obj && typeof obj === 'object') {\r\n      if (seenObjects.indexOf(obj) !== -1) {\r\n        return true;\r\n      }\r\n      seenObjects.push(obj);\r\n      for (var key in obj) {\r\n        if (obj.hasOwnProperty(key) && detect(obj[key])) {\r\n          console.log(obj, 'cycle at ' + key);\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  return detect(obj);\r\n}\r\n\r\nclass Player {\r\n\tconstructor(cam, characterClass) { \r\n\t    // essentials\r\n\t    this.cam = cam;\r\n\t    this.characterProfile = [];\r\n\t    this.characterClass = characterClass;\r\n\t    \r\n\t    // game properties\r\n\t    this.mouseMode = 'split'; // 'split' or 'character'\r\n\t    this.pointingLeft = false;\r\n\r\n\t    // inventory\r\n\t    this.inventory = {};\r\n\r\n\t    // initialize quests\r\n\t    this.initQuests();\r\n\r\n\t    // gui\r\n\t    this.gui = new GUI();\r\n\r\n\t    // number style\r\n\t    this.numberColor = color(255);\r\n\t    this.numOffsetY = 70;\r\n\t    this.numOffsetX = 0;\r\n\r\n\t    // show special number?\r\n\t    this.specialNumber = false;\r\n\t    this.specialLily = 0;\r\n\t    this.sizeSpecial = 40;\r\n\t    this.specialOffX = 30;\r\n\t    this.specialOffY = 70;\r\n\t}\r\n\r\n\tget hasQuest() {\r\n\t\treturn this.currentQuest > -1;\r\n\t}\r\n\r\n\tinstantiateCharacter() {\r\n\t\tthis.character = new this.characterClass(...this.characterProfile);\r\n\t\tthis.character.scale = this.cam.scale;\r\n\t\tfrogs[0] = this.character;\r\n\r\n    // number binds\r\n    this.binds = {\r\n    \t'Q': this.character.typeBind(1),\r\n    \t'W': this.character.typeBind(2),\r\n    \t'E': this.character.typeBind(3),\r\n    \t'R': this.character.typeBind(4)\r\n    }\r\n\r\n\t\treturn this.character;\r\n\t}\r\n\r\n\tresetCharacter() {\r\n\t\tthis.instantiateCharacter();\r\n\t\tthis.initQuests();\r\n\r\n\t\tthis.cam.target = this.character;\r\n\t}\r\n\r\n\tassignQuest(quest) {\r\n\t\tthis.questList.push(new quest(player));\r\n  \tthis.currentQuest = 0;\r\n\t}\r\n\r\n\tinitQuests() {\r\n\t    this.questList = [];\r\n\t    this.currentQuest = -1; // -1 is no quest\r\n\t    this.questDecayFrames = 0;\r\n\t    this.maxQuestFrames = 100;\r\n\t}\r\n\r\n\t/* frame */\r\n\r\n\tframe() {\r\n\t\tconst charCamCoords = this.cam.toCamCoords(this.character.posX, this.character.posY);\r\n\t\t\r\n\t\tthis.pointingLeft = (mouseX < charCamCoords[0]); // (mouseX < screenSizeX / 2) || ;\r\n\t\tthis.character.environment.envDependentFrame(this);\r\n\r\n\t\tif (this.hasQuest) {\r\n\t\t\tif (this.questList[this.currentQuest].frame()) {\r\n\t\t\t\t// if success, fade out quest window\r\n\t\t\t\tthis.questDecayFrames++;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.questDecayFrames > 0) this.questDecayFrames++;\r\n\r\n\t\t\tif (this.questDecayFrames > this.maxQuestFrames) {\r\n\t\t\t\tthis.questDecayFrames = 0;\r\n\t\t\t\tthis.questList.slice(this.currentQuest, 1);\r\n\t\t\t\tthis.currentQuest = -1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// server\r\n\t\t//if (this.character.isJumping) socket.emit('frame', [player.character.posX, player.character.posY]);\r\n\t}\r\n\r\n\t/* draw */\r\n\r\n\tdrawHunger() {\r\n\t\tconst camFrogPos = this.cam.toCamCoords(this.character.posX, this.character.posY);\r\n\r\n\t  const hungerBarWidth = gfx['flyBar'].width;\r\n\t\tconst hungerBarHeight = gfx['flyBar'].height;\r\n\t  const hungerRatio = 1 - (frog.hunger / frog.maxHunger);\r\n\r\n\t  fill(0);\r\n\t  stroke(0);\r\n\t  // textSize(24);\r\n\t  // textFont(pixelFont);\r\n\t  // text('Hunger', screenSizeX - 1.3 * gfx['flyBar'].width, 25);\r\n\r\n\t  if (frog.hungry) {\r\n\t    push();\r\n\t    tint(255, 255 * Math.cos(2 * frameCount / 60));\r\n\t    image(gfx['flyBubble'], camFrogPos[0] + frog.dimX, camFrogPos[1] - frog.dimY,\r\n\t          gfx['flyBubble'].width * cam.scale, gfx['flyBubble'].height * cam.scale);\r\n\t    pop();\r\n\t  }\r\n\r\n\t  if (frog.ateThisFrame) {\r\n\t    frog.showHeart.push(1);\r\n\t  }\r\n\r\n\t  for (const heart in frog.showHeart) {\r\n\t    if (frog.showHeart[heart] > 0) {\r\n\t      frog.showHeart[heart]++;\r\n\t      image(gfx['heart'], camFrogPos[0] + frog.dimX, camFrogPos[1] - frog.dimY - frog.showHeart[heart] / 2,\r\n\t            gfx['heart'].width * cam.scale, gfx['heart'].height * cam.scale);\r\n\t      frog.showHeart[heart] %= frog.heartFrames;\r\n\t    } else {\r\n\t      frog.showHeart.splice(heart, 1);\r\n\t    }\r\n\t  }\r\n\r\n\t  push();\r\n\t  translate(screenSizeX - gfx['flyBar'].width, 10);\r\n\t  image(gfx['flyBarGrey'], 0, 0);\r\n\t  const flyBar = gfx['flyBar'].get(0, 0, hungerRatio * hungerBarWidth, hungerBarHeight);\r\n\t  image(flyBar, 0, 0);\r\n\t  pop();\r\n\t}\r\n\r\n\tdrawQuest(quest) {\r\n\t  const opacity = 255 * (1 - this.questDecayFrames / this.maxQuestFrames);\r\n\t  quest.gui.draw(opacity);\r\n\r\n\t  push();\r\n\t  quest.draw(gfx, opacity);\r\n\t  pop();\r\n\t}\r\n\r\n\tdraw() {\r\n\t\t// main gui\r\n\t\tthis.gui.draw();\r\n\r\n\t\t// hunger gui\r\n\t\tthis.drawHunger()\r\n\r\n\t\t// quest gui\r\n\t  if (this.currentQuest > -1) {\r\n\t    this.drawQuest(this.questList[this.currentQuest]);\r\n\t  }\r\n\r\n\t  // frog gui\r\n\t  this.character.scale = this.cam.scale;\r\n\r\n\t\t// help lines\r\n\t\tif (this.cam.guiOptions['helpLines'] && this.character.type != 0) {\r\n\t\t  if (!this.character.isJumping) {\r\n\t\t    let pointDir = this.character.pointingLeft ? -1 : 1;\r\n\r\n\t\t    let startPosX = this.character.posX + this.character.dimX / 2;\r\n\t\t    let jumpDest = lilies.getLilyPos(this.character.lily + pointDir * this.character.type);\r\n\t\t    let jumpDestX = jumpDest[0] + this.character.dimX / 2 + this.character.offX;\t\t    \r\n\t\t    let jumpDestY = jumpDest[1] + this.character.offY;\r\n\r\n\t\t    this.curveParams = [startPosX, this.character.posY + this.character.dimY / 2,\r\n\t\t        (startPosX + jumpDestX) / 2, ((this.character.posY < jumpDestY) ? this.character.posY : jumpDestY) - this.character.jumpHeight + this.character.dimY / 2, \r\n\t\t        jumpDestX, jumpDestY + this.character.dimY]\r\n\t\t  }\r\n\r\n\t\t  const camCurveParams = [];\r\n\r\n\t\t  for (let k = 0; k < 3; k++) {\r\n\t\t    let pt = [this.curveParams[2 * k], this.curveParams[2 * k + 1]];\r\n\r\n\t\t    [camCurveParams[2 * k], camCurveParams[2 * k + 1]] = this.cam.toCamCoords(...pt);\r\n\t\t  }\r\n\r\n\t\t  const allCurves = [camCurveParams];\r\n\r\n\t\t  push();\r\n\t\t  setLineDash([5, 5]);\r\n\t\t  stroke(255, 128);\r\n\t\t  strokeWeight(3);\r\n\t\t  fill(0, 0, 0, 0);\r\n\r\n\t\t  let drawDot = true;\r\n\t\t  \r\n\t\t  for (const params of allCurves) {\r\n\t\t    switch (envType) {\r\n\t\t      case 'LinearLilies':\r\n\t\t        beginShape();\r\n\t\t        curveVertex(params[0], params[1]);\r\n\t\t        curveVertex(params[0], params[1]);\r\n\t\t        curveVertex(params[2], params[3]);\r\n\t\t        curveVertex(params[4], params[5]);\r\n\t\t        curveVertex(params[4], params[5]);\r\n\t\t        endShape();\r\n\r\n\t\t        break;\r\n\t\t      case 'CyclicLilies':\r\n\t\t        if (!this.character.isJumping) { \r\n\t\t          line(params[0], params[1], params[4], params[5]);\r\n\t\t        } else drawDot = false;\r\n\t\t    }\r\n\r\n\t\t    if (drawDot) {\r\n\t\t      strokeWeight(7 * this.cam.scale);\r\n\t\t      point(params[4], params[5]);\r\n\t\t    }\r\n\t\t  }\r\n\r\n\t\t  pop();\r\n\t\t}\r\n\r\n\t\t// number\r\n\t\tpush();\r\n\r\n\t\tif (this.character.changeNumber) {\r\n\t\t    this.numText = str(this.character.number);\r\n\t\t    this.lilyCamDiff = this.character.lilyPos;\r\n\t\t    this.lilyCamDiff[0] += 2 * this.numText.length + this.numOffsetX;\r\n\t\t    this.character.changeNumber = false;\r\n\t\t}\r\n\r\n\t\ttextFont(pixelFont);\r\n\t\tstroke(this.numberColor);\r\n\t\tfill(this.numberColor);\r\n\t\ttextSize(this.sizeSpecial * this.cam.scale * (1 - this.numText.length / 10));\r\n\t\ttext(this.numText, ...this.cam.toCamCoords(this.lilyCamDiff[0], this.lilyCamDiff[1] + this.numOffsetY * this.cam.scale));\r\n\r\n\t\tif (this.specialNumber) {\r\n\t\t\tlet specialPos = this.cam.toCamCoords(...this.character.environment.getLilyPos(this.specialLily));\r\n\t\t\tspecialPos[0] += this.specialOffX - 2 * this.specialLily.toString().length;\r\n\t\t\tspecialPos[1] += this.specialOffY * cam.scale;\r\n\r\n\t\t\ttext(this.specialLily.toString(), ...specialPos);\r\n\t\t}\r\n\r\n\t\tpop();\r\n\t}\r\n}"],"names":["isCyclic","obj1","seenObjects","detect","obj","indexOf","key","push","hasOwnProperty","console","log","Player","constructor","cam","characterClass","this","characterProfile","mouseMode","pointingLeft","inventory","initQuests","gui","GUI","numberColor","color","numOffsetY","numOffsetX","specialNumber","specialLily","sizeSpecial","specialOffX","specialOffY","hasQuest","currentQuest","instantiateCharacter","character","scale","frogs","binds","Q","typeBind","W","E","R","resetCharacter","target","assignQuest","quest","questList","player","questDecayFrames","maxQuestFrames","frame","charCamCoords","toCamCoords","posX","posY","mouseX","environment","envDependentFrame","slice","drawHunger","camFrogPos","hungerBarWidth","gfx","width","hungerBarHeight","height","hungerRatio","frog","hunger","maxHunger","fill","stroke","hungry","tint","Math","cos","frameCount","image","dimX","dimY","pop","ateThisFrame","showHeart","heart","heartFrames","splice","translate","screenSizeX","flyBar","get","drawQuest","opacity","draw","guiOptions","type","isJumping","pointDir","startPosX","jumpDest","lilies","getLilyPos","lily","jumpDestX","offX","jumpDestY","offY","curveParams","jumpHeight","camCurveParams","k","pt","allCurves","setLineDash","strokeWeight","drawDot","params","envType","beginShape","curveVertex","endShape","line","point","changeNumber","numText","str","number","lilyCamDiff","lilyPos","length","textFont","pixelFont","textSize","text","specialPos","toString"],"version":3,"file":"index.abe85c45.js.map"}